try {
    var digitalData = digitalData || {};
    var style = "color:#4285F4";

    var init = function() {
        console.log("%cDatalayer start...", style);
        if (Object.keys(digitalData).length === 0) {
            pageLoadTracking();
        }
        defaultClickTracking();
        console.log("%cDatalayer End.", style);
    };

    var pageLoadTracking = function() {
        var location = {};
        location.finalPaths=[];
        location.pagename = "asb";
        var i = 0;

        location.paths = window.location.pathname.toLowerCase().split("/");
        if (location.paths[1] == "content") location.paths.splice(1, 4);
        location.paths.forEach((path) => {
            if (path != undefined && path != "") {
                location.finalPaths[i] = path.replace(".html","");
                location.pagename = location.pagename + ":" + location.finalPaths[i];
                i = i+1;
            }
        });
        var section = location.finalPaths[0] ? location.finalPaths[0] : "homepage";
        var subSection = location.finalPaths[1] ? location.finalPaths[1] : "";
        var subSubSection = location.finalPaths[2] ? location.finalPaths[2] : "";
        var typeMeta = document.querySelector("meta[name='pagetype']");
        var idMeta = document.querySelector("meta[name='uniqueid']");
        var pageType = typeMeta ? typeMeta.getAttribute("content") : "";
        var uniqueId = idMeta ? idMeta.getAttribute("content") : "";

        digitalData.enable = true;
    	  digitalData.calculator = {};
    	  digitalData.error = {};
    	  digitalData.form = {};
    	  digitalData.page = {
            "url" : decodeURIComponent(window.location.href.split('?')[0]),
            "brand" : "asb",
            "platform" : "unauth web",
            "type" : pageType.replaceAll("-", " "),
            "name" : location.pagename == 'asb' ? location.pagename + ":homepage" : location.pagename.replaceAll("-", " "),
            "section" : section.replaceAll("-", " "),
            "subSection" : subSection.replaceAll("-", " "),
            "subsubsection" : subSubSection.replaceAll("-", " "),
            "id" : uniqueId
        };
        digitalData.product = {};
        digitalData.user = {"cif" : getVisitorInfo()};
        digitalData.search = {};
        digitalData.interaction = {};
        digitalData.tool = {};
        var errorPages = ["/content/asb/location/en/location/error.html","/content/asb/help/en/error.html","/content/asb/page/en/error.html"];
        if (errorPages.includes(window.location.pathname.toLowerCase())) {
            digitalData.error['description'] = "404";
            digitalData.error['message'] = "page not found";
            digitalData.error['type'] = "technical";
            digitalData.page.name = "asb:404";
            digitalData.page.type= "error-page";
            try {
                _satellite.track("asb-site-navigate");
            } catch(e) {
                console.log("%c Error in 404 tracking. Couldnot call _satellite.track(). Possible reason: Launch.js not available", style);
            }
            console.log("%c404 Error page.", style);
        }
        console.log("%cSetting datalayer values for pageload event...", style);
        document.addEventListener('DOMContentLoaded', function(e) {
            try {
                _satellite.pageBottom();
            } catch(e) {
                console.log("%c Error in page load tracking. Couldnot call _satellite.track(). Possible reason: Launch.js not available", style);
            }
            console.log("%cTrigger pageload event.", style);
        });
    };

    var defaultClickTracking = function() {
        window.addEventListener('load', (event) => {
            try {
                document.addEventListener('click', (e) => {
                    var targetEl;
                    var clickEl = e.target;
                    if (clickEl.nodeName.toLowerCase() == 'a' || clickEl.nodeName.toLowerCase() == "button") {
                        targetEl = clickEl;
                    } else if (clickEl.parentNode.nodeName.toLowerCase() == 'a' || clickEl.parentNode.nodeName.toLowerCase() == "button") {
                        targetEl = clickEl.parentNode;
                    } else if (clickEl.parentNode.parentNode.nodeName.toLowerCase() == 'a' || clickEl.parentNode.parentNode.nodeName.toLowerCase() == "button") {
                        targetEl = clickEl.parentNode.parentNode;
                    }
                    if (targetEl && targetEl.hasAttribute('data-layer-event')) {
                        const event = targetEl.getAttribute('data-layer-event');
                        let category = targetEl.hasAttribute('data-layer-category') ? targetEl.getAttribute('data-layer-category') : '';
                        let type = targetEl.hasAttribute('data-layer-type') ? targetEl.getAttribute('data-layer-type') : '';
                        let location = targetEl.hasAttribute('data-layer-location') ? targetEl.getAttribute('data-layer-location') : '';
                        let text = targetEl.hasAttribute('data-layer-text') ? targetEl.getAttribute('data-layer-text') : '';
                        if (category == "rte-link") {
                            digitalData.interaction = {
                                "category" : category,
                                "type" : "link",
                                "location" : "",
                                "text" : (targetEl.innerText || targetEl.textContent).toLowerCase().replace(/[^a-zA-Z0-9 ]+/ig, ' ')
                            };
                        } else {
                            digitalData.interaction = {
                                "category" : category.toLowerCase().replace(/[^a-zA-Z0-9 ]+/ig, ' '),
                                "type" : type.toLowerCase().replace(/[^a-zA-Z0-9 ]+/ig, ' '),
                                "location" : location.toLowerCase().replace(/[^a-zA-Z0-9 ]+/ig, ' '),
                                "text" : text.toLowerCase().replace(/[^a-zA-Z0-9 ]+/ig, ' ')
                            };
                        }
                        try {
                            if (event.toLowerCase() === "asb-site-interact") {
                                _satellite.track(event);
                            }
                        } catch(e) {
                            console.log("%c Error in click tracking, in _satellite.track(). Possible reason: Launch.js not available", style);
                        }
                        console.log("%cInteraction Event: " + event + "\n" + "category: " + digitalData.interaction.category + "\n" + "type: " + digitalData.interaction.type + "\n" + "location: " + digitalData.interaction.location + "\n" + "text: " + digitalData.interaction.text, style);
                    }
                });
            }catch(e) {
                console.log("%c" + e.message, style);
            }
        });
    }

	  var getVisitorInfo = function() {
        var visitorInfo = "";
        var bc = document.cookie ? document.cookie.split(';') : [];
        bc.forEach((item) => {
            if (item.indexOf("VisitInfo=") > -1) {
                var hcif =  item.replace("VisitInfo=", "");
                visitorInfo = hcif.indexOf("hashedCIF=") > -1 ? hcif.replace("hashedCIF=", "").trim() : "";
            }
        });
		    return visitorInfo;
	  };

    init();
	  console.log(digitalData);
} catch (e) {
    try {
        if (window.console) {
            console.log("%c" + e.message, style);
        }
    } catch (e) {}
}
